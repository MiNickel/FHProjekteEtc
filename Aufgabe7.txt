Blatt 7

Aufgabe 1: Outer Join
5 Punkte
Aus der Vorlesung: Frau Petri wollte Lizenzen nachbestellen. Sie sollen eine Liste
liefern mit allen Titeln der verlorenen oder vernichteten Lizenzen und allen Titeln, von
denen keine Lizenzen vorhanden sind…in EINEM Statement! Benutzen Sie den MySQL
oder MSSQL Dialekt.


SELECT DISTINCT titel.titel
FROM titel LEFT OUTER JOIN titel_lizenz ON titel.id = titel_lizenz.titel_id
LEFT OUTER JOIN lizenz ON lizenz.id=titel_lizenz.lizenz_id
WHERE lizenz.ausgemustert IS NOT NULL OR lizenz.verloren IS NOT NULL
OR titel_lizenz.lizenz_id IS NULL;

Aufgabe 2: Subqueries
Teil 1: Skalare Subquery
5 Punkte
Benutzen Sie den MySQL oder MSSQL Dialekt. Benutzen Sie Subqueries!
Versuchen Sie sich doch einmal an einer Abfrage, die Ihnen den Namen des/der
Angestellten zurückgibt, der/die am 8.04.2013 die Vormerkung für den Film "Herr
Lehmann" angenommen hat.

SELECT angestellter.name FROM angestellter
WHERE angestellter.id =
(SELECT angestellter_id FROM vormerkung 
	WHERE reservierung = '2013-04-08'
	AND titel_id = (
		SELECT id FROM titel WHERE titel = "Herr Lehmann")
	)
;


Teil 2: Zeilenunterabfrage
5 Punkte
Benutzen Sie den MySQL oder Oracle Dialekt. Benutzen Sie Subqueries!
Versuchen Sie doch einmal, den Namen und die ID der Kunden herauszufinden, die
dasselbe Geschlecht haben und aus dem gleichen Stadtteil kommen wie der Kunde
mit dem Namen "Fellerhoff". Nur ein Statement.

SELECT name,id FROM KUNDE 
WHERE anrede = (
	SELECT anrede FROM KUNDE WHERE name = "Fellerhoff"
)
AND plz = (
	SELECT plz FROM KUNDE WHERE name = "Fellerhoff"
);


Teil 3: Verschachtelte Tabellenunterabfrage
5 Punkte
Benutzen Sie den MySQL oder Oracle Dialekt. Benutzen Sie Subqueries!
Versuchen Sie doch einmal, die Titel der Lizenzen herauszufinden, die von den
Kunden mit demselben Geschlecht und derselben Postleitzahl vorbestellt wurden wie
der Kunde mit dem Namen "Selen...irgendwas". Nur ein Statement.
(Anmerkung: Ich habe 5 Verschachtelungen gebraucht.)

SELECT titel
FROM titel
WHERE id IN (
	SELECT titel_id
	FROM vormerkung
	WHERE mitgliedschaft_id IN (
		SELECT id
		FROM mitgliedschaft
		WHERE kunde_id IN (
			SELECT id
			FROM kunde
			WHERE (anrede,plz) IN (
				SELECT anrede,plz
				FROM kunde
				WHERE name LIKE "Selen%")
			)
		)
	)
;


